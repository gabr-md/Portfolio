[["data-sciente-e-credit-scoring.html", "2 Data Sciente e Credit Scoring 2.1 Banco de Dados 2.2 Análise Descritiva 2.3 Modelagem 2.4 Criação de política 2.5 Conclusão 2.6 Referências", " 2 Data Sciente e Credit Scoring Como grande entusiasta de modelos estatísticos e de crédito, busco sempre reter mais conhecimento sobre a área, nas últimas semanas venho lendo o livro Credit Scoring do Abharam Laredo. Nele o autor passa toda sua experiência sobre o tema e no final fornece alguns bancos de dados e um problema que pode ser utilizado para colocar em prática tudo o que é ensinado durante a leitura. Aproveitei essa oportunidade e usei o problema proposto para desenvolver um modelo e uma política de crédito que solucione o caso em questão. Atividade proposta: A Livraria Dorela faz financiamento de livros de acordo com um score definido de forma subjetiva, a taxa de rejeição era de 30% e a taxa aplicada era muito baixa, visto isso, os resultados não eram satisfatórios. O novo diretor de crédito da Dorela decidiu desenvolver um modelo para essa operação. Ele coletou uma amostra aleatória de 3.000 clientes cujo financiamento foi realizado no período de julho de 2007 a junho de 2008, ele considerou a performance do cliente nos 6 meses seguintes, e classificou como mau cliente aquele que teve qualquer atraso acima de 30 dias, caso contrário era classificado com bom cliente. Com esse banco de dados disponível vou iniciar o estudo e propor ao final um modelo de crédito e política que atenda a necessidade da livraria Dorela. 2.1 Banco de Dados # Lendo dataset #data &lt;- readxl::read_xls(&quot;351.xls&quot;) data &lt;- data.table::fread(&quot;banco.csv&quot;) # Selecionando as colunas de interesse data &lt;- data %&gt;% dplyr::select(IDADE,UNIFED,FONE,INSTRU,CARTAO,RESTR,RESID,FICCAO,NAOFICCAO,AUTOAJUDA,CATEG,STATUS) # Tipo das colunas da base de dados glimpse(data) ## Rows: 3,000 ## Columns: 12 ## $ IDADE &lt;int&gt; 26, 43, 33, 39, 43, 40, 39, 50, 51, 45, 67, 34, 49, 59, 41, ~ ## $ UNIFED &lt;chr&gt; &quot;SP&quot;, &quot;SP&quot;, &quot;OUTROS&quot;, &quot;RJ&quot;, &quot;OUTROS&quot;, &quot;RJ&quot;, &quot;SP&quot;, &quot;SP&quot;, &quot;OUT~ ## $ FONE &lt;chr&gt; &quot;SIM&quot;, &quot;SIM&quot;, &quot;SIM&quot;, &quot;SIM&quot;, &quot;SIM&quot;, &quot;SIM&quot;, &quot;SIM&quot;, &quot;SIM&quot;, &quot;SIM~ ## $ INSTRU &lt;chr&gt; &quot;PRIM &amp; SEC&quot;, &quot;SUP&quot;, &quot;SUP&quot;, &quot;MV&quot;, &quot;PRIM &amp; SEC&quot;, &quot;PRIM &amp; SEC&quot;~ ## $ CARTAO &lt;chr&gt; &quot;SIM&quot;, &quot;NAO&quot;, &quot;NAO&quot;, &quot;SIM&quot;, &quot;SIM&quot;, &quot;SIM&quot;, &quot;MV&quot;, &quot;SIM&quot;, &quot;SIM&quot;~ ## $ RESTR &lt;chr&gt; &quot;SIM&quot;, &quot;SIM&quot;, &quot;SIM&quot;, &quot;NAO&quot;, &quot;NAO&quot;, &quot;NAO&quot;, &quot;NAO&quot;, &quot;NAO&quot;, &quot;SIM~ ## $ RESID &lt;chr&gt; &quot;PROP&quot;, &quot;ALUG&quot;, &quot;PROP&quot;, &quot;PROP&quot;, &quot;PROP&quot;, &quot;PROP&quot;, &quot;PROP&quot;, &quot;PRO~ ## $ FICCAO &lt;chr&gt; &quot;SIM&quot;, &quot;NAO&quot;, &quot;SIM&quot;, &quot;SIM&quot;, &quot;SIM&quot;, &quot;SIM&quot;, &quot;SIM&quot;, &quot;SIM&quot;, &quot;SIM~ ## $ NAOFICCAO &lt;chr&gt; &quot;NAO&quot;, &quot;NAO&quot;, &quot;NAO&quot;, &quot;NAO&quot;, &quot;NAO&quot;, &quot;NAO&quot;, &quot;NAO&quot;, &quot;NAO&quot;, &quot;NAO~ ## $ AUTOAJUDA &lt;chr&gt; &quot;SIM&quot;, &quot;SIM&quot;, &quot;NAO&quot;, &quot;NAO&quot;, &quot;NAO&quot;, &quot;SIM&quot;, &quot;NAO&quot;, &quot;NAO&quot;, &quot;NAO~ ## $ CATEG &lt;int&gt; 1, 1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, ~ ## $ STATUS &lt;chr&gt; &quot;MAU&quot;, &quot;MAU&quot;, &quot;BOM&quot;, &quot;BOM&quot;, &quot;BOM&quot;, &quot;BOM&quot;, &quot;MAU&quot;, &quot;BOM&quot;, &quot;BOM~ Primeiro passo foi abrir a base de dados, selecionar as colunas que são interessantes para o estudo e aplicar a função glimpse para entender as variáveis do banco de dados. Entre as variáveis, temos: Idade: idade do cliente em anos; UNIFED: estado do cliente (SP, RJ e Outros); FONE: indica se há presença de telefone fixo ou não; INSTRU: nível de escolaridade; CARTAO: tem cartão de crédito; RESTR: apresenta algum restritivo no mercado; RESID: mora em residência própria ou alugada; FICCAO: comprou livro de ficção; NAOFICCAO: comprou livro de não ficção; AUTOAJUDA: comprou livro de autoajuda; CATEG: comprou dois livros ou mais; STATUS: variável resposta, bom ou mau cliente. Com isso é possível mapear se a classe da variável é numérica, string ou fator. Essa diferença entre as classes das varáveis pode interferir na análise descritiva e na modelagem. Antes de prosseguir para a análise descritiva, seria necessário fazer uma análise de dados faltantes (missing) e outliers (anomalias). Como é dito na descrição da base de dados que não há dados faltantes ou qualquer anomalia, farei apenas uma análise simples e rápida para confirmar essa informação. # NA table(is.na(data)) ## ## FALSE ## 36000 # Vazio table(data == &quot;&quot;) ## ## FALSE ## 36000 2.2 Análise Descritiva Ao trabalhar com uma base de dados de variável resposta binária é importante ver qual é a proporção dessa variável, nesse caso, de bons e maus clientes. # Status prop.table(table(data$STATUS)) ## ## BOM MAU ## 0.8 0.2 Nota-se então que de todos os 3.000 clientes, 80% são bons e 20% apresentaram atraso maior do que 30 dias. Após esse passo é possível seguir com a análise das variáveis preditoras, começando com a variável numérica idade. ## metrica Bom Mau ## 1 min 18.00 18.00000 ## 2 1 quartil 34.00 30.00000 ## 3 mediana 41.00 37.00000 ## 4 media 42.72 38.28333 ## 5 3 quartil 49.25 45.00000 ## 6 max 88.00 70.00000 Nota-se acima que aparenta ter pouca diferença de idade entre as classes de bons e maus pagadores, a média de idade dos bons pagadores é 4 anos maior que a dos maus pagadores. Para analisar as variáveis categóricas foi criada uma pequena função que monta tabelas com a proporção de bons e maus pagadores em cada uma das classes das variáveis. Foram analisadas primeiramente as variáveis de UNIFED, FONE, INSTRU e CARTAO. FONE perc.bom perc.mau perc.total NÃO 81.69% 18.31% 100% SIM 79.82% 20.18% 100% UNIFED perc.bom perc.mau perc.total OUTROS 72.63% 27.37% 100% RJ 88.33% 11.67% 100% SP 76.81% 23.19% 100% CARTAO perc.bom perc.mau perc.total MV 71.79% 28.21% 100% NAO 74.39% 25.61% 100% SIM 81.91% 18.09% 100% INSTRU perc.bom perc.mau perc.total MV 82.83% 17.17% 100% PRIM &amp; SEC 70.82% 29.18% 100% SUP 83.61% 16.39% 100% Como a base de dados é de uma época em que telefones fixos eram mais utilizados, era esperado que a variável FONE apresentasse uma diferença maior na distribuição de bons e maus clientes entre as classes, entretanto, a proporção de clientes bons e maus é semelhante, ficando próximo dos 80% de bons pagadores. Já na tabela da variável UNIFED é possível notar que os clientes do RJ apresentam uma taxa menor de maus clientes, podendo ser um fator importante para a variável. Na tabela de CARTAO, aqueles que previamente já tinham um cartão apresentaram uma taxa menor de inadimplência e os clientes sem cartão e sem informação (MV) apresentaram uma distribuição semelhante de maus clientes, não foi nenhuma junção de classe considerando MV como um fator. Na variável INSTRU, aqueles que têm nível PRIM E SEC mostraram uma distribuição de bons e maus clientes diferente das classes SUP e de MV, que tiveram uma distribuição semelhante, nesse caso também não foi feito junção de níveis, mantendo o MV. RESTR perc.bom perc.mau perc.total NAO 84.93% 15.07% 100% SIM 51.14% 48.86% 100% RESID perc.bom perc.mau perc.total ALUG 72.92% 27.08% 100% PROP 81.04% 18.96% 100% FICCAO perc.bom perc.mau perc.total NAO 73.66% 26.34% 100% SIM 83.38% 16.62% 100% NAOFICCAO perc.bom perc.mau perc.total NAO 79.94% 20.06% 100% SIM 81.08% 18.92% 100% A variável RESTR, como esperado, segmenta bem a base de clientes, dentre os que apresentam restritivos, 49% são maus clientes e entre os que não tem restritivos, 84% são bons clientes. Na variável RESID a proporção de bons clientes é maior para os clientes que têm casa própria. Na variável FICCAO, que informa se o cliente comprou livro de ficção, vemos que entre os que compram este tipo de livro a proporção de bons clientes é maior do que entre os que não compraram. Já na variável de NAOFICCAO não vemos uma diferença entre os níveis dela. CATEG perc.bom perc.mau perc.total 0 74.57% 25.43% 100% 1 85.01% 14.99% 100% AUTOAJUDA perc.bom perc.mau perc.total NAO 90.06% 9.94% 100% SIM 63.56% 36.44% 100% A variável CATEG mostra que entre aqueles que compram 2 livros ou mais, a inadimplência é menor. Já a variável que aponta aqueles clientes que compraram livro de auto ajuda o percentual de maus pagadores é, aproximadamente, 4x maior do que aqueles que não compraram livros de auto ajuda. 2.3 Modelagem Para fazer a criação do modelo é necessário fazer uma divisão entre banco treino e teste, tendo o banco treino 70% da base de dados e o teste 30%. Essa divisão é feita mantendo a mesma proporção de maus clientes nos dois bancos. Fazendo isso pode-se avaliar a performance do modelos em uma base que não seja utilizada para o ajuste do modelo. library(caret) library(dplyr) set.seed(12345) indice = createDataPartition(y=data$STATUS, p=0.7, list=FALSE) treino = data[indice, ] teste = data[-indice, ] treino &lt;- treino %&gt;% mutate(STATUS = ifelse(STATUS == &#39;BOM&#39;,&quot;0&quot;,&quot;1&quot;), STATUS = as.numeric(STATUS)) # Fazendo os modelos fit1 &lt;- glm(STATUS ~.,data = treino, family = &quot;binomial&quot;) resultado &lt;- summary(fit1) kbl(resultado$coefficients,align = &quot;c&quot;, format = &quot;html&quot;) %&gt;% kable_paper(&quot;hover&quot;, full_width = F) Estimate Std. Error z value Pr(&gt;|z|) (Intercept) -0.5500702 0.5833602 -0.9429340 0.3457146 IDADE -0.0263951 0.0057399 -4.5985591 0.0000043 UNIFEDRJ -0.8800942 0.1781381 -4.9405172 0.0000008 UNIFEDSP -0.0005601 0.1577207 -0.0035514 0.9971664 FONESIM 0.2029430 0.2381533 0.8521526 0.3941294 INSTRUPRIM &amp; SEC 0.8644363 0.1871078 4.6199896 0.0000038 INSTRUSUP 0.0818779 0.1751249 0.4675398 0.6401137 CARTAONAO -0.6621534 0.4055050 -1.6329108 0.1024878 CARTAOSIM -1.2483886 0.3943353 -3.1658046 0.0015465 RESTRSIM 1.6857027 0.1649983 10.2164841 0.0000000 RESIDPROP -0.2427704 0.1899731 -1.2779196 0.2012778 FICCAOSIM 0.8406594 0.1682863 4.9954122 0.0000006 NAOFICCAOSIM 0.2916317 0.3035979 0.9605852 0.3367608 AUTOAJUDASIM 2.9919784 0.1995661 14.9924165 0.0000000 CATEG -2.3008406 0.2046361 -11.2435719 0.0000000 No resultado do modelo há algumas variáveis que não foram significativas, pois o resultado do P-Valor está abaixo de 0,05 (nível de significância), visto isso, elas foram retiradas e uma nova modelagem sem essas variáveis foi feita. Estimate Std. Error z value Pr(&gt;|z|) (Intercept) -0.6160197 0.5139124 -1.1986862 0.2306500 IDADE -0.0263839 0.0056977 -4.6306058 0.0000036 UNIFEDRJ -0.8615245 0.1776068 -4.8507402 0.0000012 UNIFEDSP 0.0155509 0.1571826 0.0989354 0.9211896 INSTRUPRIM &amp; SEC 0.8770520 0.1863918 4.7054204 0.0000025 INSTRUSUP 0.0904156 0.1731469 0.5221902 0.6015379 CARTAONAO -0.6150139 0.4048910 -1.5189616 0.1287722 CARTAOSIM -1.2139085 0.3937900 -3.0826289 0.0020518 RESTRSIM 1.6854795 0.1636982 10.2962634 0.0000000 FICCAOSIM 0.8471162 0.1680679 5.0403196 0.0000005 AUTOAJUDASIM 2.9931425 0.1994726 15.0052828 0.0000000 CATEG -2.3113245 0.2046182 -11.2957927 0.0000000 Agora todas as variáveis foram influentes, então é possível prosseguir a análise fazendo a escoragem e analisando a performance do modelo feito na base de teste. Para avaliar o modelo foi utilizado o KS (maior diferença entre a frequência acumulada de bons e maus pagadores) e o AUC (área abaixo da curva) com curva ROC. O KS resultante de 55%, apesar de ser muito bom, não é visto com frequência em uma modelagem de crédito real, esse resultado alinhado com um AUC de 0,86 mostra que o modelo ficou bem ajustado. 2.4 Criação de política Com o modelo ajustado e performance verificada é importante ver como esse modelo irá se comportar dentro de uma política de crédito. Como o objetivo da livraria é dar crédito sendo justa e não focando exclusivamente no lucro, não será necessário colocar impedimentos na política de crédito para clientes com restritivo ou que compram livros de autoajuda apesar da inadimplência maior nesses perfis. Para controlar possíveis perdas foram utilizadas taxas de 2,5%, 5% e 7,5% que variam de acordo com o perfil do cliente. Serão financiados compras de livros que fiquem na faixa de 100 à 1000 reais com planos que variam de 2 a 6 vezes, aplicando um limite que dependerá do tipo de livro comprado e da presença de restritivos. Abaixo há a regra que será aplicada independente do ponto de corte a ser escolhido: Limite máximo de 500 reais para clientes que apesar do score, compraram livro de autoajuda; Limite máximo de 400 reais para clientes que apesar do score, apresentam restritivo; Limite máximo de 300 reais para clientes que apesar do score, comparam livros de autoajuda e apresentam restritivos; Para escolher o ponto de corte ideal para essa operação uma simulação será feita com diferentes limiares de corte. Em cada simulação uma amostra da base original será sorteada aleatoriamente contendo bons e maus clientes. Em seguida é feita uma atribuição de valores de compra e plano escolhidos a partir daqueles que serão utilizados na operação. Ao final de cada simulação será registrado a inadimplência, produção e aprovação. Com esses KPIs (Key Performance Indicators) será possível escolher o valor de score que maximiza a produção da livraria com uma boa taxa de aprovação e uma baixa inadimplência. Os pontos de corte que serão testados são: 516, 602, 644 e 734. Esses limiares foram escolhidos pois acima deles a uma mudança na taxa de maus clientes. Acima de 516 pontos não há uma taxa de maus clientes por range de score acima de 10%; Acima de 602 pontos não há uma taxa de maus clientes por range de score acima de 5,5%; Acima de 644 pontos não há uma taxa de maus clientes por range de score acima de 4%; Acima de 734 pontos não há uma taxa de maus clientes por range de score acima de 1,5%; Corte 516 Corte 602 Corte 644 Corte 734 produção_media R$ 128.494,20 R$ 108.390,00 R$ 94.246,07 R$ 55.679,61 aprovação_media 85,07% 69,4% 59,84% 34,55% inadimplencia_media 10,15% 4,86% 3,05% 0,66% Analisando os resultados da escoragem o ponto de corte escolhido foi de 602. O ponto de score 516, apesar de ter a maior podução, resulta em 10% de inadimplência. Já o ponto de score de 734, que tem a menor taxa de inadimplência, resulta em uma produção baixa quando comparada com os outros limiares. Visando alta aprovação, baixa inadimplência e uma produção com volume, será utilizado o ponto de corte de 602 pontos. 2.5 Conclusão O modelo logístico aplicado aos dados apresentados conseguiu uma boa performance, ou seja, consegue segmentar bem os clientes que são bons e maus pagadores. Com ajuda do modelo e um conhecimento prévio da operação e de crédito, foi possível chegar em uma política de crédito interessante, que varia a taxa e o limite aplicado para cada cliente de acordo com perfil de risco, mantendo a taxa de aprovação alta e uma baixa inadimplência. A política final ficou da seguinte forma: Limite total para clientes com score acima de 602 e taxa de 2,5%; Limite máximo de 500 reais para clientes que apesar do score, compraram livro de autoajuda e taxa de 5%; Limite máximo de 400 reais para clientes que apesar do score, apresentam restritivo e taxa de 7,5%; Limite máximo de 300 reais para clientes que apesar do score, comparam livros de autoajuda e apresentam restritivos e taxa de 7,5%; 2.6 Referências SICSU, Abraham Laredo. Credit Scoring: Desenvolvimento, Implantação, Acompanhamento. São Paulo: Blucher, 2010 "]]
